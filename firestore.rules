rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Quizzes: Public read, validated writes
    match /quizzes/{quizId} {
      allow read: if true;
      allow write: if isValidQuiz();
    }
    
    // Quiz Results: Public read, validated writes
    match /quizResults/{resultId} {
      allow read: if true;
      allow create: if isValidResult();
      allow update, delete: if false;
    }
    
    function isValidQuiz() {
      return request.resource.data.title is string &&
             request.resource.data.title.size() > 0 &&
             request.resource.data.questions is list &&
             request.resource.data.questions.size() > 0;
    }
    
    function isValidResult() {
      return request.resource.data.userName is string &&
             request.resource.data.userName.size() <= 50 &&
             request.resource.data.score is number &&
             request.resource.data.percentage >= 0 &&
             request.resource.data.percentage <= 100;
    }
  }
}
